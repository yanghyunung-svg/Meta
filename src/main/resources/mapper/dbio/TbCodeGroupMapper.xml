<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.meta.mapper.dbio.TbCodeGroupMapper">

   <!--tb_code_group SELECT-->
   <select id="getData" parameterType="com.meta.dto.TbCodeGroupDto" resultType="com.meta.dto.TbCodeGroupDto">
      SELECT GRP_CD
        , GRP_NM
        , STTS_CD
        , ORD
        , RMK
        , CRT_ID, UPD_ID
        , date_format(CRT_DTTM, '%Y-%m-%d %H:%i:%s') AS CRT_DTTM
        , date_format(UPD_DTTM, '%Y-%m-%d %H:%i:%s') AS UPD_DTTM
        FROM tb_code_group
       WHERE GRP_CD = #{grpCd}
  </select>

   <!--tb_code_group INSERT-->
   <insert id="insertData" parameterType="com.meta.dto.TbCodeGroupDto">
     INSERT INTO tb_code_group (
            GRP_CD
          , GRP_NM
          , STTS_CD
          , ORD
          , RMK
          , CRT_ID
          , UPD_ID
     )
     VALUES (
            #{grpCd}
          , #{grpNm}
          , #{sttsCd}
          , 0
          , #{rmk}
          , #{crtId}
          , #{updId}
     ) 
  </insert>

   <!--tb_code_group UPDATE-->
   <update id="updateData" parameterType="com.meta.dto.TbCodeGroupDto">
     UPDATE tb_code_group
        SET GRP_NM = #{grpNm}
          , STTS_CD = #{sttsCd}
          , RMK = #{rmk}
          , UPD_ID = #{updId}
      WHERE GRP_CD = #{grpCd}
   </update>

   <!--tb_code_group DELETE-->
   <delete id="deleteData" parameterType="com.meta.dto.TbCodeGroupDto">
     DELETE
       FROM tb_code_group
      WHERE GRP_CD = #{grpCd}
   </delete>

   <!--tb_code_group RECORD LOCK SELECT-->
   <select id="getLockData" parameterType="com.meta.dto.TbCodeGroupDto" resultType="com.meta.dto.TbCodeGroupDto">
      SELECT GRP_CD
           , GRP_NM
           , STTS_CD
           , ORD
           , RMK
       , CRT_ID, UPD_ID
       , date_format(CRT_DTTM, '%Y-%m-%d %H:%i:%s') AS CRT_DTTM
       , date_format(UPD_DTTM, '%Y-%m-%d %H:%i:%s') AS UPD_DTTM
        FROM tb_code_group
       WHERE GRP_CD = #{grpCd}
         FOR UPDATE
  </select>


    <!--tb_code_group LIST SELECT-->
    <select id="getListData" parameterType="com.meta.dto.TbCodeGroupDto" resultType="com.meta.dto.TbCodeGroupDto">
        SELECT
        g.GRP_CD,
        g.GRP_NM,
        g.STTS_CD,
        g.ORD,
        g.RMK,
        g.CRT_ID,
        g.UPD_ID,
        DATE_FORMAT(g.CRT_DTTM, '%Y-%m-%d %H:%i:%s') AS CRT_DTTM,
        DATE_FORMAT(g.UPD_DTTM, '%Y-%m-%d %H:%i:%s') AS UPD_DTTM,
        COUNT(d.CD) AS DETL_CNT
        FROM tb_code_group g
        LEFT JOIN tb_code_detl d
        ON g.GRP_CD = d.GRP_CD
        WHERE 1=1
        <if test="grpCd != null and grpCd != ''">
            AND g.GRP_CD LIKE CONCAT('%', #{grpCd}, '%')
        </if>
        <if test="grpNm != null and grpNm != ''">
            AND g.GRP_NM LIKE CONCAT('%', #{grpNm}, '%')
        </if>
        <if test="sttsCd != null and sttsCd != ''">
            AND g.STTS_CD = #{sttsCd}
        </if>
        GROUP BY
        g.GRP_CD,
        g.GRP_NM,
        g.STTS_CD,
        g.ORD,
        g.RMK,
        g.CRT_ID,
        g.UPD_ID,
        g.CRT_DTTM,
        g.UPD_DTTM
        ORDER BY g.GRP_CD, g.GRP_NM


    </select>


    <select id="countData" parameterType="com.meta.dto.TbCodeGroupDto" resultType="int">
        SELECT COUNT(*)
        FROM tb_code_group
        WHERE GRP_CD = #{grpCd}
    </select>
</mapper>
