<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>Upbit 마켓별 목록 </title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f4f7fa; padding: 20px; margin: 0; }
        .container { max-width: 1200px; margin: 0 auto; }

        /* 가로 3열 레이아웃 설정 */
        .market-wrapper { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; align-items: start; }

        .market-column { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); overflow: hidden; }
        .column-header { padding: 15px; text-align: center; color: white; font-weight: bold; font-size: 18px; }

        /* 마켓별 테마 컬러 */
        .bg-krw { background: #d60000; } /* 레드 */
        .bg-btc { background: #0046ff; } /* 블루 */
        .bg-usdt { background: #26a69a; } /* 그린 */

        .list-container { max-height: 700px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #f8f9fa; font-size: 12px; padding: 10px; border-bottom: 2px solid #eee; }
        td { padding: 10px; font-size: 13px; border-bottom: 1px solid #f1f1f1; }
        .market-code { color: #888; font-size: 11px; }

        /* 스크롤바 디자인 */
        .list-container::-webkit-scrollbar { width: 6px; }
        .list-container::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
    </style>
    <link rel="stylesheet" href="/css/mainLayout.css">
    <script src="/js/mainLayout.js" defer></script>
    <script src="/js/sideLayout.js" defer></script>
    <script src="/js/commonUtils.js" defer></script>
</head>
<body>

<div class="container">
    <div id="topbarContainer"></div>
    <div id="sidebarContainer"></div>
    <div class="mainHeadContainer">
            <h2> 업비트 마켓 리스트 </h2>
            <button id="btnSearch"  type="button" class="hidden">데이터 불러오기</button>
    </div>

<div class="mainTableContainer">
    <div class="market-wrapper">
        <div class="market-column">
            <div class="column-header bg-krw">KRW (원화) <span id="cntKRW">0</span></div>
            <div class="list-container">
                <table id="tableKRW">
                    <thead><tr><th>코인명</th><th>코드</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="market-column">
            <div class="column-header bg-btc">BTC (비트코인) <span id="cntBTC">0</span></div>
            <div class="list-container">
                <table id="tableBTC">
                    <thead><tr><th>코인명</th><th>코드</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <div class="market-column">
            <div class="column-header bg-usdt">USDT (테더) <span id="cntUSDT">0</span></div>
            <div class="list-container">
                <table id="tableUSDT">
                    <thead><tr><th>코인명</th><th>코드</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

</div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {

        const btnSearch = document.getElementById('btnSearch');

        btnSearch.addEventListener('click', async () => {
            try {
                const response = await fetch("https://api.upbit.com/v1/market/all");
                const markets = await response.json();

                // 1. 마켓별 분류
                const krwList = markets.filter(m => m.market.startsWith("KRW-"));
                const btcList = markets.filter(m => m.market.startsWith("BTC-"));
                const usdtList = markets.filter(m => m.market.startsWith("USDT-"));

                // 2. 카운트 업데이트
                document.getElementById('cntKRW').innerText = `(${krwList.length})`;
                document.getElementById('cntBTC').innerText = `(${btcList.length})`;
                document.getElementById('cntUSDT').innerText = `(${usdtList.length})`;

                // 3. 각 테이블 렌더링 함수
                const render = (targetId, list) => {
                    const tbody = document.querySelector(`#${targetId} tbody`);
                    tbody.innerHTML = list.map(item => `
                        <tr>
                            <td><b>${item.korean_name}</b></td>
                            <td><span class="market-code">${item.market}</span></td>
                        </tr>
                    `).join('');
                };

                render("tableKRW", krwList);
                render("tableBTC", btcList);
                render("tableUSDT", usdtList);

            } catch (err) {
                console.error(err);
                alert("조회 실패! CORS 설정을 확인하세요.");
            }
        });

        // 실행
        setTimeout(() => btnSearch.click(), 100);
    });
</script>

</body>
</html>