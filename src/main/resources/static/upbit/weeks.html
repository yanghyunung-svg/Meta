<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>캔들 조회</title>
    <link rel="stylesheet" href="/css/upbitLayout.css">
    <script src="/js/mainLayout.js" defer></script>
    <script src="/js/sideLayout.js" defer></script>

</head>
<body>
<div class="container">
    <div id="topbarContainer"></div>
    <div id="sidebarContainer"></div>

    <div class="mainHeadContainer">
        <h2 style="margin:0;"> ✅ 캔들 조회</h2>
    </div>

    <div class="mainBodyContainer">
        <table id="upbit-table">
            <thead>
            <tr>
                <th>market</th>
                <th style="text-align:center;">집계시작일자</th>
                <th style="text-align:right;">시가</th>
                <th style="text-align:right;">고가</th>
                <th style="text-align:right;">저가</th>
                <th style="text-align:right;">종가</th>
                <th style="text-align:right;">누적금액 </th>
                <th style="text-align:right;">누적수량 </th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        async function loadCandles() {
            const markets = ["KRW-MLK", "KRW-MOCA", "KRW-ONG"];
          const unit = 1;
          const count = 5;

          try {
            // 1. 마켓명 매핑 가져오기
            const marketRes = await fetch("https://api.upbit.com/v1/market/all");
            const marketData = await marketRes.json();
            const marketMap = {};
            marketData.forEach(m => {
              marketMap[m.market] = { korean: m.korean_name, english: m.english_name };
            });

            // 2. 각 마켓별 캔들 데이터 조회
            const results = await Promise.all(
              markets.map(market =>
                fetch(`https://api.upbit.com/v1/candles/weeks?market=${market}&count=${count}`)
                  .then(res => res.json())
                  .then(data => ({ market, candles: data }))
              )
            );

            // 3. 테이블에 표시
            const tbody = document.querySelector("#upbit-table tbody");
            tbody.innerHTML = "";

            results.forEach(result => {
              // 섹션 헤더 (마켓명 표시)
              const headerRow = document.createElement("tr");
              headerRow.style.backgroundColor = "#e0e0e0";
              headerRow.innerHTML = `
                <td colspan="10" style="font-weight:bold; text-align:center;">
                  ${result.market.replace("KRW-", "")} - ${marketMap[result.market]?.korean} (${marketMap[result.market]?.english})
                </td>
              `;
              tbody.appendChild(headerRow);

              // 캔들 데이터 행 추가
              result.candles.forEach(candle => {
             // console.log(candle);

                const row = document.createElement("tr");
                row.innerHTML = `
                  <td>${candle.market.replace("KRW-", "")}</td>
                  <td style="text-align:center;">${candle.first_day_of_period}</td>
                  <td style="text-align:right;">${candle.opening_price.toLocaleString()}</td>
                  <td style="text-align:right;">${candle.high_price.toLocaleString()}</td>
                  <td style="text-align:right;">${candle.low_price.toLocaleString()}</td>
                  <td style="text-align:right;">${candle.trade_price.toLocaleString()}</td>
                  <td style="text-align:right;">${candle.candle_acc_trade_price.toLocaleString()}</td>
                  <td style="text-align:right;">${candle.candle_acc_trade_volume.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
              });
            });
          } catch (err) {
            console.error("Fetch error:", err);w
          }
        }

        // 최초 실행
        loadCandles();
    </script>


</body>
</html>
