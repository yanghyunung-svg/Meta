<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>Meta System</title>
    <link rel="stylesheet" href="/css/layout.css">
    <script src="/js/config.js"></script>
</head>
<body>

<div class="popupnContainer" id="popupnContainer">

    <div class="popup-header">
        <h2 class="popup-title">사용자 등록</h2>
        <button id="btnClose" class="btn-close">x</button>
    </div>

    <table class="popup-table">
        <tr>
            <th>사용자ID</th>
            <td> <input type="text" id="userId" class="form-input" > </td>
        </tr>
        <tr>
            <th>사용자이름</th>
            <td> <input type="text" id="userNm" class="form-input"  > </td>
        </tr>
        <tr>
            <th>비밀번호</th>
            <td> <input type="password" id="password" class="form-input"  > </td>
        </tr>
        <tr>
            <th>이메일</th>
            <td> <input type="text" id="email" class="form-input"  > </td>
        </tr>
        <tr>
            <th>전화번호</th>
            <td> <input type="text" id="phone" class="form-input"  > </td>
        </tr>
        <tr>
            <th>권한</th>
            <td>
            <select id="role" class="form-input">
                <option value="1">ADMIN</option>
                <option value="2">USER</option>
            </select>
            </td>
        </tr>
        <tr>
            <th>상태</th>
            <td>
            <select id="useYn" class="form-input">
                <option value="Y">사용</option>
                <option value="N">미사용</option>
            </select>
        </td>
        </tr>
    </table>

<div class="button-row" style="display:flex; gap:8px;">
    <button id="btnInit" class="btn">초기화</button>
    <button id="btnReg" class="btn">저장</button>
</div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {

        const userId   = document.getElementById("userId");
        const userNm   = document.getElementById("userNm");
        const password   = document.getElementById("password");
        const email = document.getElementById("email");
        const phone = document.getElementById("phone");
        const role = document.getElementById("role");
        const useYn = document.getElementById("useYn");

        // 📌 초기화 버튼
        document.getElementById("btnInit").addEventListener("click", () => {
            userId.value = "";
            userNm.value = "";
            password.value = "";
            email.value = "";
            phone.value = "";
            role.value = "";
            useYn.value = "";
        });

        // 📌 저장 버튼
        document.getElementById("btnReg").addEventListener("click", async () => {

            const data = {
                userId: userId.value.trim(),
                userNm: userNm.value.trim(),
                password: password.value.trim(),
                email: email.value.trim(),
                phone: phone.value.trim(),
                role: role.value.trim(),
                useYn: useYn.value.trim()
            };

            // 간단한 입력 체크
            if (!data.userId) {
                alert("사용자ID를 입력하세요.");
                userId.focus();
                return;
            }

            try {
                const response = await fetch("/meta/insertUserData", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error("서버 오류 발생");
                }

                const result = await response.json();

                if (result.success) {
                    alert("저장되었습니다.");
                    window.close();
                } else {
                    alert("저장 실패: " + result.message);
                }

            } catch (err) {
                console.error(err);
                alert("요청 중 오류가 발생했습니다.");
            }
        });
    });

    document.getElementById("btnClose").addEventListener("click", () => {
        window.close();
    });

</script>

</body>
</html>